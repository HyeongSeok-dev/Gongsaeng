<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.gongsaeng.mapper.BoardMapper">
	<insert id="insertBoard">
	<selectKey keyProperty="board_idx" resultType="int" order="BEFORE">
		SELECT IFNULL(MAX(board_idx), 0)
		FROM board
	</selectKey>
	INSERT
	INTO board
	VALUES (
		#{board_idx} + 1
		, #{member_id}
		, #{board_subject}
		, #{board_content}
		, now()
		, #{board_main_category}
		, #{board_sub_category}
		, #{board_img1}
		, #{board_img2}
		, #{board_img3}
	)
	</insert>
	
	<!-- 글 목록 조회 - SELECT -->
	<select id="selectBoardList" resultType="board">
		SELECT *
		FROM board 
		<if test="!searchKeyword.equals('')">
			WHERE
			<choose>
				<when test="searchType.equals('subject')">
					board_subject LIKE CONCAT('%',#{searchKeyword},'%')
				</when>
				<when test="searchType.equals('content')">
					board_content LIKE CONCAT('%',#{searchKeyword},'%')
				</when>
				<when test="searchType.equals('subject_content')">
					board_subject LIKE CONCAT('%',#{searchKeyword},'%')
					OR board_content LIKE CONCAT('%',#{searchKeyword},'%')
				</when>
				<when test="searchType.equals('name')">
					board_name LIKE #{searchKeyword}
				</when>
				<otherwise>
					1=1 -- WHERE 절을 포함하되 조건을 걸고 싶지 않을 경우 활용 가능한 조건식
				</otherwise>
			</choose>
		</if>
		ORDER BY
			board_re_ref DESC
			, board_re_seq ASC
		LIMIT
			#{startRow}
			, #{listLimit}
	</select>
	
	<!-- 전체 글 목록 갯수 조회 - SELECT -->
	<select id="selectBoardListCount" resultType="int">
		SELECT COUNT(*)
		FROM board
	</select>
</mapper>